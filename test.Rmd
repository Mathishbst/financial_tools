---
title: "√âtudes des cycles financier"
author: "Fabien Noisette, Mathis Herbst, Maja Hemms et Ma√Øwenn Patron"
date: "Mardi 11 F√©vrier 2025"
lang: "fr"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: no
    theme: flatly
    df_print: paged
  github_document:
    toc: true
    toc_depth: 3
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(car)
library(readxl)
library(mFilter)
library(BCDating)
```

# Point de vue sur les donn√©es

## Importation des donn√©es

```{r data, message=FALSE, warning=FALSE}
# m√©thode robuste : chemin relatif au .Rmd
infile  <- knitr::current_input()
doc_dir <- if (!is.null(infile)) dirname(normalizePath(infile)) else getwd()

# üëâ mets ici le NOM EXACT de ton fichier (dans le m√™me dossier que le .Rmd)
path_xlsx <- file.path(doc_dir, "econometriefinale2.xlsx")

if (!file.exists(path_xlsx)) {
  stop("‚ùå Fichier Excel introuvable : ", normalizePath(path_xlsx, mustWork = FALSE))
}

# test d'ouverture (lister les onglets)
readxl::excel_sheets(path_xlsx)

# lecture
df <- readxl::read_xlsx(path_xlsx)
```

## V√©rification des donn√©es

```{r traitement1}
head(df)
nrow(df)
ncol(df)
sum(is.na(df))
```

Il y a un total de **2718** observations, pour un total de **56** variables diff√©rentes, plus que suffisante pour l'analyse.  
On remarque qu'il existe une grande quantit√© de donn√©es "NA" (**31457**). On va ainsi se concentrer sur les variables contenant le moins de ces donn√©es manquantes.

## Premi√®re analyse des donn√©es

Une fa√ßon √©clair√©e de choisir une bonne direction pour notre analyse est de v√©rifier la matrice de corr√©lation entre une donn√©e pr√©existante "*crisis*", variable indicatrice indiquant si l'ann√©e correspond √† une crise et les autres variables du jeu de donn√©es

On remarque par exemple que pour les √âtats-Unis, *crisis* nous donne 1 pour les ann√©es 2008, 1930, qui correspond √† des crises connues pour ce pays.

Ainsi cela va nous permettre d'obtenir les variables les plus sensibles √† ces p√©riodes

```{r}
# D√©finition explicite des variables √† tester (coh√©rent avec ton texte)
variables_a_tester <- c("ltd","stir","eq_capgain","ca")

# Contr√¥les de s√©curit√© pour √©viter les erreurs
stopifnot(is.data.frame(df))
stopifnot(is.character(variables_a_tester))

cols <- c("crisis", variables_a_tester)
missing <- setdiff(cols, names(df))
if (length(missing) > 0) {
  stop("Colonnes manquantes dans df : ", paste(missing, collapse = ", "))
}

# Sous-√©chantillon des colonnes (on utilise bien 'df' et pas 'data')
model_data <- df[, cols, drop = FALSE]
```

On remarque que des variables comme *stir* ou *ltd* ont un grande corr√©lation positive avec *crisis*, et que *eq_capgain* et *ca* ont √©galement une grande corr√©lation positive avec *crisis*. Ainsi nous pourrons partir sur ces variables.

## Description des variables :
* *stir* : Short-term Interest Rate, Taux d'int√©r√™t √† court terme, exprim√© en pourcentage annuel.
* *ltd* : Loan-to-Deposit Ratio, Ratio pr√™t/d√©p√¥t des banques.
* *eq_capgain* : Equity Capital Gain, Gain en capital sur les actions.
* *ca* : Current Account Balance, Balance courante du pays.

```{r traitement2}
# Construction conforme √† ton code d'origine, mais en utilisant 'df'
datatrait <- data.frame(
  year       = df$year,
  country    = df$country,
  crisis     = df$crisis,
  ltd        = df$ltd,
  stir       = df$stir,
  eq_capgain = df$eq_capgain,
  ca         = df$ca
)
summary(datatrait)
```
